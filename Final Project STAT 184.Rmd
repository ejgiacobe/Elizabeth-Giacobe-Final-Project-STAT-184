---
title: "Measles Outbreaks"
author: Elizabeth Giacobe
output: html_notebook
---

## Research Question
- How does the measles virus spread in different areas?
- Does population density and travel distance affect this? 


## Data Access
*(3) Access to all data sources is contained within the analysis*

```{r, message= FALSE}
#clean ups
rm(list = ls()) 

#loaded tidyverse
library(tidyverse)
library(rvest)
```

```{r}
page2 <- "https://www.nationmaster.com/country-info/stats/Transport/Commute/Distance"
tableList2 <- page2 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)

length(tableList2)
RawTransport <- tableList2[[1]]

RawTransport
```
```{r}
Transport <-
  RawTransport %>%
  select(COUNTRY, AMOUNT) %>%
  rename(country = COUNTRY, distance = AMOUNT) %>%
  mutate(distance = readr::parse_number(distance))

Transport
```


```{r}
page1 <- "https://www.nationmaster.com/country-info/stats/Geography/Area/Land/Per-capita"
tableList1 <- page1 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)

length(tableList1)
RawCountries <- tableList1[[1]]

RawCountries
```

```{r}
Countries <-
  RawCountries %>%
  select(COUNTRY, AMOUNT) %>%
  rename(country = COUNTRY, pop_dens = AMOUNT) %>%
  mutate(pop_dens = readr::parse_number(pop_dens)) %>%
  filter(!grepl("[(profile)]$", country))

Countries
```


```{r, message=FALSE}
# getting data
MeaslesOutbreaks <- read_csv("C:\\Users\\Lizzie\\Downloads\\MeaslesOutbreaks.csv")

MeaslesVac1 <- read_csv("C:\\Users\\Lizzie\\Downloads\\Measles1Vac.csv")

MeaslesVac2 <- read_csv("C:\\Users\\Lizzie\\Downloads\\Measles2Vac.csv")

MeaslesOutbreaks
```

```{r}
glimpse(MeaslesOutbreaks)
glimpse(MeaslesVac1)
glimpse(MeaslesVac2)
```
There are multiple variables for the same information in the outbreaks data. The variable names are not correct for the vaccinataion data. Look at missing values. 

```{r}
nrow(MeaslesOutbreaks)
nrow(MeaslesVac1)
nrow(MeaslesVac2)
```
The vaccine data doesn't have the same amount of cases so see which countries aren't included in the Vac2 data that are included in the Vac1 data. 

## Data Wrangling
Skills used: 
* data verbs   
* joins for multiple data tables  
* spread & gather to stack/unstack variables  
* reduction and/or transformation functions (mean, sum, max, min, n(), rank, pmin) 
* machine learning
```{r}
# renamed varaibles so that they were one word and selected only the needed variables

MeaslesOutbreaksClean <-
  MeaslesOutbreaks %>%
  rename("year" = "YEAR (DISPLAY)", "region" = "REGION (DISPLAY)", "income_group" = "WORLDBANKINCOMEGROUP (DISPLAY)", "country" = "COUNTRY (DISPLAY)", "outbreaks" = "Display Value") %>%
  select(year, region, income_group, country, outbreaks)

head(MeaslesOutbreaksClean)
```

```{r}
# makes variable names the contents of the first row
colnames(MeaslesVac1) <- as.character(unlist(MeaslesVac1[1,]))

# takes out first row (repeat of variable names)
MeaslesVac1 = MeaslesVac1[-1, ]

head(MeaslesVac1)
```
```{r}
# makes variable names the contents of the first row
colnames(MeaslesVac2) <- as.character(unlist(MeaslesVac2[1,]))

# takes out first row (repeat of variable names)
MeaslesVac2 = MeaslesVac2[-1, ]

head(MeaslesVac2)
```

### Vaccine Data Together
```{r}
MeaslesVac1Narrow <-
  MeaslesVac1 %>%
  select(Country, `2000`, `2001`, `2002`, `2003`, `2004`, `2005`, `2006`, `2007`, `2008`, `2009`, `2010`, `2011`, `2012`, `2013`, `2014`, `2015`, `2016`, `2017`, `2018`) %>%
  gather(key = "year", value = vac1, `2000`, `2001`, `2002`, `2003`, `2004`, `2005`, `2006`, `2007`, `2008`, `2009`, `2010`, `2011`, `2012`, `2013`, `2014`, `2015`, `2016`, `2017`, `2018`)

MeaslesVac2Narrow <-
  MeaslesVac2 %>%
  select(Country, `2000`, `2001`, `2002`, `2003`, `2004`, `2005`, `2006`, `2007`, `2008`, `2009`, `2010`, `2011`, `2012`, `2013`, `2014`, `2015`, `2016`, `2017`, `2018`) %>%
  gather(key = "year", value = vac2, `2000`, `2001`, `2002`, `2003`, `2004`, `2005`, `2006`, `2007`, `2008`, `2009`, `2010`, `2011`, `2012`, `2013`, `2014`, `2015`, `2016`, `2017`, `2018`)
```

```{r}
MeaslesVacBoth <-
  left_join(MeaslesVac1Narrow, MeaslesVac2Narrow, by = c("Country", "year")) %>%
  rename("country"= "Country")
  
MeaslesVacBoth
```

```{r}
MeaslesOutbreaksSum <-
  MeaslesOutbreaksClean %>%
  group_by(year, country) %>%
  summarise(outbreaks = sum(outbreaks)) %>%
  filter(grepl("^20", year))

MeaslesOutbreaksSum
```

```{r}
MeaslesVacBoth <-
  MeaslesVacBoth %>%
  mutate(year = as.numeric(year))

Measles <-
  inner_join(MeaslesOutbreaksSum, MeaslesVacBoth, by = c("country", "year"))

Measles
```

```{r}
Measles %>%
  group_by(year) %>%
  summarise(count = n_distinct(country)) %>%
  arrange(desc(count))

MeaslesSml <-
  Measles %>%
  filter(year == 2004)
```


```{r}
MeaslesPop <-
  inner_join(Countries, MeaslesSml, by = "country", "country")

MeaslesPopTransport <-
  inner_join(Transport, MeaslesPop, by = "country", "country")

MeaslesPopTransport
```


## Data Visualization
(*1*) relevant to stated research question for the analysis, (*2*) include at least one effective display of many--at least 3--variables, and (*3*) include 3 of the following 6 visualization techniques learned in STAT 184: 
* use of multiple geoms such as points, density, lines, segments, boxplots, bar charts, histograms, etc 
* use of multiple aesthetics--not necessarily all in the same graph--such as color, size, shape, x/y position, facets, etc 
* leaflet maps 
* decision tree and/or dendogram displaying machine learning model results
